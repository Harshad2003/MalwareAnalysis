# Malware Analysis - Sikomode

## Tools Used:

## Basic Analysis

- File hashes
- VirusTotal
- FLOSS
- PEStudio
- PEView
- Wireshark
- Inetsim
- Netcat
- TCPView
- Procmon

## Advanced Analysis

- Cutter
- Debugger

## Finding the language in which  binary is written

Bring the unknown.exe file to the desktop and perform normal static analysis. To find the language use **floss. \Desktop\unknown.exe | grep “nim”** command. We can see that all the method calls starts with **nim** which is the language in which the binary is written.

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%201.png)

## Finding the File Hash

We will check for file hash using Get-FileHash -Algorithms SHA256 “unknown.exe” command and submit to Virus-total to check for the results. The hash value will be displayed.

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%202.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%203.png)

## Finding the architecture of the binary

**PEview** is used here. When we load the unknown.exe file in it, it says 64-bit files are provided here. Finding it is 64-bit ,we open it in **pestudio** which gives details that this is an x64 bit architecture binary for a 64 bit CPU.

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%204.png)

## Checking the Binary Persistency

**Procmon (Process Monitor) tool** can be used to find whether binary is persistent or not. A malware achieve persistence by adding an entry to the run keys in Windows Registry or the Startup folder. But when we run the exe file in Procmon and observe the filter, we can’t find any host based indicators like registry keys or process IDs which means that this a **non-persistent binary.** 

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%205.png)

## Conditions that can delete the binary by itself

When the inetsim (internet Simulator) i.e., REMnux is running behind, then the exe file does not delete itself. When the inetsim is offed, then the file gets deleted when clicked after performing some malicious activity on the system. This is can be dynamically observed using Wireshark tool. Also when we kill the inetsim during the executables routine ,then it deletes itself.

## Callback Domains

To determine the first callback of this binary, we use **Wireshark** to listen to the file. We see the TCP handshake and capture the first HTTP packet that comes. In its header we can find a large URL. When we grep the URL as command there is no result shown. When we again scroll down in the filter and find a HTTP request which is exfiltration domain. So there are two different domains(callback,exfiltrate).

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%206.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%207.png)

## Conditions that the binary exfiltrate data

The binary must contact the initial domain that is the URL which we found out. If it makes a successful connection to it, then it will start to exfiltrate data. The data it is exfiltrating is **cosmo.jpeg.**  But if it does not connect to the URL, then it will close itself from the desk.

## Exfiltration Domains

## Exfiltration process

The file is cosmo.jpeg and the kind of data exfiltrated from it can be found using wireshark. When we click on the **feed get request ,**we find a large piece of data below in full URL(post=….). The datas from the jpeg file is read by the malware in someway either encoded or encrypted and used with this get request.

## Encryptions Used

Advanced analysis can be done to find this. One way to find is to look at the string references in the imported libraries. We go back to commander and check for **floss .unknown.exe | grep “RC4”**, it might be RC4 algorithm used by looking at the stream of strings. something related to 2RC4 occurs. In order to learn more, we use **Cutter too**l to analyse and load in it. We search for 2rc4 and select to graph view for better info in which we can find the 2rc4 method call. After discovering we can find that **stealstuff** is making call to 2rc4. 

After knowing it is done with rc2 we can discover the key for encryption. Using the Procmon, we can filter with **Process Contains unknown** and **Operation is CreateFile.** We refresh by deleting and running the .exe file again. We can find that a new file named **\Public\passwd.txt** is been created. We open the passwd file and see the text **sikomode** which is the passwd for the encryption.

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%208.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%209.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%2010.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%2011.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%2012.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%2013.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%2014.png)

## ‘houdini’

Houdini is the method call used by the exe to delete itself from the desk. We can discover what is the significance of Houdini using **Cutter tool.** Checking in main method(.**NimMainModule**) to see where this method call is used. In that after the **kill function returns false** ,houdini is used which directly jumps to the end of the program. Another instance is that, if the **kill function returns true** then **steal operations** are performed. If it is interrupted (as seen before), houdini is called and also at the end of task completion, houdini is called finally.

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%2015.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%2016.png)

![Untitled](Malware%20Analysis%20-%20Sikomode%20b9426b56372543b792289e91cd9740fc/Untitled%2017.png)